# ğŸ‰ Supabaseæ•°æ®åº“é›†æˆå®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒæ¶æ„
- âœ… **Supabaseå®¢æˆ·ç«¯é…ç½®** (`src/lib/supabase.ts`)
- âœ… **å®Œæ•´çš„æ•°æ®åº“ç±»å‹å®šä¹‰** (`src/types/database.ts`)
- âœ… **null-safeæ•°æ®åº“æœåŠ¡å±‚** (`src/lib/database/services.ts`)
- âœ… **æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬** (`database/init.sql`)

### 2. APIæ¥å£é›†æˆ
- âœ… **æ–°å¢æ•°æ®åº“èµ„äº§API** (`/api/database/assets`)
- âœ… **Story Protocolæ³¨å†ŒAPI** é›†æˆæ•°æ®åº“æŒä¹…åŒ–
- âœ… **ç”¨æˆ·ä»ªè¡¨æ¿** ä»æ•°æ®åº“è¯»å–çœŸå®æ•°æ®

### 3. æ•°æ®åº“è¡¨è®¾è®¡
```sql
users           - ç”¨æˆ·ä¿¡æ¯è¡¨
ip_assets       - IPèµ„äº§æ ¸å¿ƒè¡¨
license_terms   - æˆæƒæ¡æ¬¾è¡¨
transactions    - äº¤æ˜“è®°å½•è¡¨
earnings        - æ”¶ç›Šç»Ÿè®¡è¡¨
```

### 4. å®‰å…¨ç‰¹æ€§
- âœ… **è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)** é…ç½®
- âœ… **ç¯å¢ƒå˜é‡ä¿æŠ¤** APIå¯†é’¥
- âœ… **null-safeç¼–ç¨‹** é˜²æ­¢æœªé…ç½®æ—¶å´©æºƒ
- âœ… **TypeScriptç±»å‹å®‰å…¨**

### 5. å®¹é”™æœºåˆ¶
- âœ… **é…ç½®æ£€æµ‹** - è‡ªåŠ¨æ£€æµ‹Supabaseæ˜¯å¦å·²é…ç½®
- âœ… **é™çº§ç­–ç•¥** - æœªé…ç½®æ—¶è¿”å›æ¨¡æ‹Ÿæ•°æ®
- âœ… **é”™è¯¯å¤„ç†** - å®Œå–„çš„å¼‚å¸¸æ•è·å’Œæ—¥å¿—è®°å½•

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½å®ç°

### å®Œæ•´çš„æ•°æ®æµç¨‹
1. **å†…å®¹ä¸Šä¼ ** â†’ åˆ›å»ºIPèµ„äº§è®°å½•
2. **åŒºå—é“¾æ³¨å†Œ** â†’ æ›´æ–°äº¤æ˜“ä¿¡æ¯
3. **æˆæƒæ¡æ¬¾** â†’ å­˜å‚¨è®¸å¯ä¿¡æ¯
4. **æ”¶ç›Šå¥–åŠ±** â†’ è®°å½•ä»£å¸åˆ†å‘
5. **ç”¨æˆ·ä»ªè¡¨æ¿** â†’ å±•ç¤ºèµ„äº§ç»Ÿè®¡

### APIç«¯ç‚¹æ€»è§ˆ
```
POST /api/database/assets     - åˆ›å»ºIPèµ„äº§
GET  /api/database/assets     - æŸ¥è¯¢ç”¨æˆ·èµ„äº§
PUT  /api/database/assets     - æ›´æ–°èµ„äº§çŠ¶æ€
POST /api/story/register      - æ³¨å†Œ+æ•°æ®åº“é›†æˆ
```

## ğŸ“‹ ä½¿ç”¨æŒ‡å—

### 1. é…ç½®Supabase (å¯é€‰)
å¦‚æœæƒ³ä½¿ç”¨çœŸå®æ•°æ®åº“ï¼Œè¯·æŒ‰ç…§ `SUPABASE_SETUP.md` é…ç½®ï¼š

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-key
```

### 2. æœªé…ç½®æ—¶çš„è¡Œä¸º
- ğŸ”„ **è‡ªåŠ¨é™çº§** - ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œä¸å½±å“åŠŸèƒ½æ¼”ç¤º
- ğŸ“ **æ—¥å¿—æç¤º** - æ§åˆ¶å°æ˜¾ç¤º"Supabaseæœªé…ç½®"è­¦å‘Š
- âœ… **æ­£å¸¸è¿è¡Œ** - æ‰€æœ‰é¡µé¢å’ŒåŠŸèƒ½æ­£å¸¸å·¥ä½œ

### 3. æ•°æ®åº“è¡¨åˆ›å»º
è¿è¡Œ `database/init.sql` ä¸­çš„SQLè¯­å¥åˆ›å»ºè¡¨ç»“æ„

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. ç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ
```typescript
// å®Œå…¨ç±»å‹åŒ–çš„æ•°æ®åº“æ“ä½œ
const result = await DatabaseService.createIPAsset({
  title: "æˆ‘çš„ä½œå“",
  creatorAddress: "0x...",
  contentScore: 85
})
// result æ‹¥æœ‰å®Œæ•´çš„ TypeScript ç±»å‹
```

### 2. ä¼˜é›…çš„é”™è¯¯å¤„ç†
```typescript
// ç»Ÿä¸€çš„å“åº”æ ¼å¼
{ success: boolean, data: T | null, error: any }

// null-safe æ“ä½œ
if (!supabase) {
  return { success: false, error: 'Supabaseæœªé…ç½®' }
}
```

### 3. å®æ—¶æ•°æ®åŒæ­¥å‡†å¤‡
```typescript
// é¢„ç•™å®æ—¶è®¢é˜…æ¥å£
const subscription = supabase
  .channel('ip_assets_changes')
  .on('postgres_changes', { ... }, callback)
  .subscribe()
```

## ğŸ“Š æ•°æ®æ¨¡å‹å…³ç³»

```mermaid
erDiagram
    users ||--o{ ip_assets : creates
    users ||--o{ earnings : earns
    ip_assets ||--|| license_terms : has
    ip_assets ||--o{ transactions : generates
    ip_assets ||--o{ earnings : from
```

## ğŸ¯ ç«‹å³å¯ç”¨åŠŸèƒ½

### 1. ç”¨æˆ·èµ„äº§ç®¡ç†
- åˆ›å»ºIPèµ„äº§è®°å½•
- æŸ¥çœ‹èµ„äº§åˆ—è¡¨å’ŒçŠ¶æ€
- ç»Ÿè®¡æ”¶ç›Šå’Œäº¤æ˜“

### 2. æˆæƒæ¡æ¬¾ç®¡ç†
- AIç”Ÿæˆçš„æ¡æ¬¾å­˜å‚¨
- ç‰ˆç¨è®¾ç½®è®°å½•
- æˆæƒå†å²è¿½è¸ª

### 3. äº¤æ˜“è®°å½•è¿½è¸ª
- åŒºå—é“¾äº¤æ˜“è®°å½•
- Gasè´¹ç”¨ç»Ÿè®¡
- äº¤æ˜“çŠ¶æ€ç›‘æ§

## ğŸš¨ æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ
- âœ… **æ— éœ€é…ç½®å³å¯è¿è¡Œ** - è‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
- ğŸ“ **æ§åˆ¶å°æ—¥å¿—æ¸…æ™°** - ä¾¿äºè°ƒè¯•å’Œç›‘æ§
- ğŸ”„ **çƒ­é‡è½½æ”¯æŒ** - å¼€å‘ä½“éªŒæµç•…

### ç”Ÿäº§ç¯å¢ƒ
- âš ï¸ **å¿…é¡»é…ç½®çœŸå®æ•°æ®åº“** - ç”Ÿäº§ç¯å¢ƒä¸åº”ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
- ğŸ” **ç¯å¢ƒå˜é‡å®‰å…¨** - ä½¿ç”¨ä¸“ç”¨çš„ç”Ÿäº§å¯†é’¥
- ğŸ“Š **ç›‘æ§å’Œå¤‡ä»½** - è®¾ç½®æ•°æ®åº“ç›‘æ§

## ğŸŠ é›†æˆæ•ˆæœ

### Before (é›†æˆå‰)
```typescript
// ç¡¬ç¼–ç æ¨¡æ‹Ÿæ•°æ®
const mockAssets = [
  { id: 1, title: "ç¤ºä¾‹èµ„äº§" }
]
```

### After (é›†æˆå)
```typescript
// çœŸå®æ•°æ®åº“é©±åŠ¨
const result = await DatabaseService.getUserIPAssets(address)
const assets = result.data // æ¥è‡ªSupabaseçš„å®æ—¶æ•°æ®
```

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. é«˜ä¼˜å…ˆçº§
- ğŸ”‘ **é…ç½®çœŸå®APIå¯†é’¥** (WalletConnect, OpenAIç­‰)
- ğŸ—„ï¸ **åˆ›å»ºSupabaseé¡¹ç›®** å¹¶æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
- ğŸ§ª **æ·»åŠ æ•°æ®åº“æµ‹è¯•** ç¡®ä¿æ•°æ®å®Œæ•´æ€§

### 2. ä¸­ä¼˜å…ˆçº§
- ğŸ”„ **å®æ—¶æ•°æ®è®¢é˜…** èµ„äº§çŠ¶æ€å˜æ›´é€šçŸ¥
- ğŸ“ˆ **æ•°æ®åˆ†æé¢æ¿** æ”¶ç›Šè¶‹åŠ¿å›¾è¡¨
- ğŸ” **æœç´¢å’Œç­›é€‰** èµ„äº§ç®¡ç†åŠŸèƒ½

### 3. é•¿æœŸä¼˜åŒ–
- ğŸ“± **ç¦»çº¿æ”¯æŒ** PWAç¼“å­˜ç­–ç•¥
- ğŸŒ **å¤šåŒºåŸŸéƒ¨ç½²** æ•°æ®åº“è¯»å†™åˆ†ç¦»
- ğŸ¤– **è‡ªåŠ¨åŒ–å¤‡ä»½** å®šæ—¶æ•°æ®å¤‡ä»½

---

**ğŸ‰ æ•°æ®åº“é›†æˆå·²å®Œæˆï¼é¡¹ç›®ç°åœ¨å…·å¤‡äº†å®Œæ•´çš„æ•°æ®æŒä¹…åŒ–èƒ½åŠ›ï¼Œå¯ä»¥åœ¨æœ‰/æ— Supabaseé…ç½®çš„æƒ…å†µä¸‹æ­£å¸¸è¿è¡Œã€‚**

**æ„å»ºçŠ¶æ€**: âœ… é€šè¿‡
**ç±»å‹æ£€æŸ¥**: âœ… é€šè¿‡
**åŠŸèƒ½æµ‹è¯•**: âœ… æ­£å¸¸è¿è¡Œ

**ä¸‹ä¸€æ­¥**: æŒ‰ç…§ `TODO.md` ç»§ç»­é…ç½®çœŸå®çš„APIå¯†é’¥ï¼Œè®©é¡¹ç›®åŠŸèƒ½æ›´åŠ å®Œæ•´ï¼